$(function($){!function(e){var t=e(".shop-sch-left"),o=e(".show-item"),a=e(".shop-sch-l-list");t.hover(function(){a.show()},function(){a.hide()}),a.children().first().css("color","#e30b20"),o.html(a.children().first().html()),a.click(function(t){"li"==t.target.nodeName.toLowerCase()&&(e(t.target).siblings().css("color",""),e(t.target).css("color","#e30b20"),o.html(e(t.target).html()))})}($),function($){function showMsg(e){$(".collectSuccess").html(e).show(),flag&&(flag=!1,setTimeout(function(){$(".collectSuccess").fadeOut(300),flag=!0},3e3))}function countPrice(){for(var e=shopConMid.find(".checkAll"),t=0,o=0,a=0;a<e.length;a++)e.eq(a).prop("checked")&&(t+=parseInt(shopConMid.children().eq(a).find(".num-ipt").val()),o+=Number(shopConMid.children().eq(a).attr("data-price"))*parseInt(shopConMid.children().eq(a).find(".num-ipt").val()));$(".goods-num-box span").html(t),$(".alltotal-price-box span").html("￥"+o.toFixed(2))}function judgeChecked(){for(var e=0,t=0;t<checkAll.length;t++)checkAll.eq(t).prop("checked")&&e++;e==checkAll.length?$(".allChecked").prop("checked",!0):e<checkAll.length&&$(".allChecked").prop("checked",!1)}var shopCon=$(".shopping-content"),shopConMid=$(".shop-con-goods-mid"),checkAll=shopConMid.find(".checkAll"),numIpt=$(".num-ipt"),flag=!0;numIpt.keyup(function(){var e=$(this).attr("data-store");Number($(this).attr("value"))<1?$(this).attr({value:1}):Number($(this).attr("value"))>=e&&$(this).attr({value:e})}),shopCon.mouseover(function(e){e.target.className.match(/font-color/)&&$(e.target).stop(!0).animate({color:"#e30b20"},300)}).mouseout(function(e){e.target.className.match(/font-color/)&&$(e.target).stop(!0).animate({color:"#666"},300)}).click(function(e){if(e.target.className.match(/operate-del/))$.get("updateGoodsBasket.php",{request:"delete",goodsId:$(e.target).attr("goods-id")},function(data){var res=eval(data),num=0,price=0;if($(e.target.parentNode.parentNode).remove(),0==res.length)$(".S_down").show(),$(".shopping-content").hide();else{for(var i=0;i<res.length;i++)"1"==res[i].goodsSelect&&(num+=Number(res[i].number),price+=Number(res[i].number)*Number(res[i].price));$(".goods-num-box").children("span").html(num),$(".alltotal-price-box").children("span").html("￥"+price.toFixed(2))}});else if(e.target.className.match(/operate-favorite/))showMsg("收藏成功");else if(e.target.className.match(/subbtn/)){var nowValue=parseInt($(e.target).next().val());nowValue<=1?($(e.target).next().val(1),showMsg("数量不能等于0")):($(e.target).next().val(--nowValue),$.get("addGoodsBasket.php",{goodsId:$(e.target).parent().attr("goods-id"),number:-1},function(){countPrice()}))}else if(e.target.className.match(/addbtn/)){var nowValue=parseInt($(e.target).prev().val()),maxValue=parseInt($(e.target).parent().parent().attr("data-stock"));nowValue>=maxValue?showMsg("最大库存了"):($(e.target).prev().val(++nowValue),$.get("addGoodsBasket.php",{goodsId:$(e.target).parent().attr("goods-id"),number:1},function(){countPrice()}))}}),shopConMid.click(function(e){if(e.target.className.match(/checkAll/)){var t=0;judgeChecked(),t=$(e.target).prop("checked")?1:0,$.get("updateGoodsBasket.php",{request:"single",goodsId:$(e.target).parent().attr("data-id"),goodsSelect:t},function(){countPrice()})}});for(var i=0;i<checkAll.length;i++)Number(checkAll.eq(i).attr("goods-select"))&&checkAll.eq(i).prop("checked",!0);judgeChecked(),countPrice(),$(".allChecked").click(function(){var e=0;this.checked?($(".checkAll").prop("checked",!0),e=1):($(".checkAll").prop("checked",!1),e=0),$.get("updateGoodsBasket.php",{request:"update",goodsSelect:e},function(){countPrice()})})}($)});